const CACHE_NAME="berbagi-cerita-v4",BASE_URL=self.location.origin,urlsToCache=[`${BASE_URL}/`,`${BASE_URL}/index.html`,`${BASE_URL}/app.bundle.js`,`${BASE_URL}/styles/styles.css`,`${BASE_URL}/images/favicon.png`,`${BASE_URL}/images/logo.png`];self.addEventListener("install",(e=>{e.waitUntil(caches.open(CACHE_NAME).then((e=>e.addAll(urlsToCache)))),self.skipWaiting()})),self.addEventListener("activate",(e=>{e.waitUntil(caches.keys().then((e=>Promise.all(e.map((e=>{if(e!==CACHE_NAME)return console.log("Deleting old cache:",e),caches.delete(e)})))))),self.clients.claim()})),self.addEventListener("fetch",(e=>{const{request:t}=e;t.url.includes("https://story-api.dicoding.dev/")?e.respondWith(fetch(t).catch((()=>caches.match(t)))):e.respondWith(caches.match(t).then((e=>e||fetch(t))))})),self.addEventListener("push",(e=>{let t="Ada notifikasi baru dari Berbagi Cerita!";if(e.data)try{const i=e.data.json();t=i.options?.body||t}catch{t=e.data.text()}const i={body:t,icon:"/images/logo.png",badge:"/images/favicon.png",vibrate:[100,50,100],data:{dateOfArrival:Date.now(),primaryKey:1}};e.waitUntil(self.registration.showNotification("Berbagi Cerita",i))})),self.addEventListener("notificationclick",(e=>{e.notification.close(),e.waitUntil(clients.openWindow("./"))})),self.addEventListener("fetch",(e=>{const{request:t}=e;t.url.includes("https://story-api.dicoding.dev/")?e.respondWith(fetch(t).catch((()=>caches.match(t)))):e.respondWith(caches.match(t).then((e=>e||fetch(t).catch((()=>{if("navigate"===t.mode)return caches.match(`${BASE_URL}/index.html`)})))))}));