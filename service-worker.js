const CACHE_NAME="berbagi-cerita-v4",BASE_URL=self.location.origin,urlsToCache=[`${BASE_URL}/`,`${BASE_URL}/index.html`,`${BASE_URL}/app.bundle.js`,`${BASE_URL}/styles/styles.css`,`${BASE_URL}/images/favicon.png`,`${BASE_URL}/images/logo.png`];self.addEventListener("install",(e=>{e.waitUntil(caches.open(CACHE_NAME).then((e=>e.addAll(urlsToCache)))),self.skipWaiting()})),self.addEventListener("activate",(e=>{e.waitUntil(caches.keys().then((e=>Promise.all(e.map((e=>{if(e!==CACHE_NAME)return console.log("Deleting old cache:",e),caches.delete(e)})))))),self.clients.claim()})),self.addEventListener("fetch",(e=>{const{request:t}=e;t.url.includes("https://story-api.dicoding.dev/")?e.respondWith(fetch(t).catch((()=>caches.match(t)))):e.respondWith(caches.match(t).then((e=>e||fetch(t))))})),self.addEventListener("push",(e=>{console.log("ðŸ“© Push event:",e);let t={title:"Berbagi Cerita",body:"Ada notifikasi baru!",icon:"/images/logo.png"};if(e.data)try{const i=e.data.json();t.title=i.title||"Berbagi Cerita",t.body=i.options?.body||i.body||"Ada notifikasi baru!",t.icon=i.options?.icon||"/images/logo.png"}catch(i){t.body=e.data.text()}const i={body:t.body,icon:t.icon,badge:"/images/favicon.png",vibrate:[100,50,100]};e.waitUntil(self.registration.showNotification(t.title,i))})),self.addEventListener("notificationclick",(e=>{e.notification.close(),e.waitUntil(clients.matchAll({type:"window",includeUncontrolled:!0}).then((e=>{for(const t of e)if(t.url.includes(self.location.origin)&&"focus"in t)return t.focus();if(clients.openWindow)return clients.openWindow(`${self.location.origin}/Berbagi-Cerita-Apps/`)})))})),self.addEventListener("fetch",(e=>{const{request:t}=e;t.url.includes("https://story-api.dicoding.dev/")?e.respondWith(fetch(t).catch((()=>caches.match(t)))):e.respondWith(caches.match(t).then((e=>e||fetch(t).catch((()=>{if("navigate"===t.mode)return caches.match(`${BASE_URL}/index.html`)})))))}));